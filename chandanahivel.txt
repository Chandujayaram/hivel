const fileSystem = require("fs");

const inputData = JSON.parse(fileSystem.readFileSync("input.json", "utf8"));

const totalN = inputData.keys.n;
const totalK = inputData.keys.k;

let xValues = [];
let yValues = [];

let indexCounter = 0;
for (let itemKey of Object.keys(inputData)) {
    if (itemKey === "keys") continue;
    indexCounter++;
    if (indexCounter > totalK) break;

    let numberBase = parseInt(inputData[itemKey].base);
    let encodedVal = inputData[itemKey].value;

    let decodedValue = parseInt(encodedVal, numberBase);

    xValues.push(parseInt(itemKey));
    yValues.push(decodedValue);
}

function constructMatrix(xValues, sizeK) {
    let matrix = [];
    for (let r = 0; r < sizeK; r++) {
        let matrixRow = [];
        for (let c = 0; c < sizeK; c++) {
            matrixRow.push(Math.pow(xValues[r], c));
        }
        matrix.push(matrixRow);
    }
    return matrix;
}

function solveUsingGaussian(matrixA, vectorB) {
    let len = matrixA.length;

    for (let i = 0; i < len; i++) {
        let pivotRow = i;
        for (let j = i + 1; j < len; j++) {
            if (Math.abs(matrixA[j][i]) > Math.abs(matrixA[pivotRow][i])) pivotRow = j;
        }

        [matrixA[i], matrixA[pivotRow]] = [matrixA[pivotRow], matrixA[i]];
        [vectorB[i], vectorB[pivotRow]] = [vectorB[pivotRow], vectorB[i]];

        for (let j = i + 1; j < len; j++) {
            let multiplier = matrixA[j][i] / matrixA[i][i];
            for (let k2 = i; k2 < len; k2++) {
                matrixA[j][k2] -= multiplier * matrixA[i][k2];
            }
            vectorB[j] -= multiplier * vectorB[i];
        }
    }

    let solutionVector = Array(len).fill(0);
    for (let i = len - 1; i >= 0; i--) {
        let tempSum = vectorB[i];
        for (let j = i + 1; j < len; j++) {
            tempSum -= matrixA[i][j] * solutionVector[j];
        }
        solutionVector[i] = tempSum / matrixA[i][i];
    }

    return solutionVector;
}

let finalMatrix = constructMatrix(xValues, totalK);
let polyCoefficients = solveUsingGaussian(finalMatrix, yValues);

console.log("Constant term C =", polyCoefficients[0]);

